<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mmtax.business.mapper.EsignFlowMapper">
    
    <resultMap type="com.mmtax.business.domain.EsignFlow" id="EsignFlowResult">
        <result property="id"    column="id"    />
        <result property="cusEsignId"    column="cus_esign_id"    />
        <result property="autoArchive"    column="auto_archive"    />
        <result property="businessScene"    column="business_scene"    />
        <result property="noticeDeveloperUrl"    column="notice_developer_url"    />
        <result property="redirectUrl"    column="redirect_url"    />
        <result property="noticeType"    column="notice_type"    />
        <result property="contractValidity"    column="contract_validity"    />
        <result property="contractRemind"    column="contract_remind"    />
        <result property="signValidity"    column="sign_validity"    />
        <result property="flowId"    column="flow_id"    />
        <result property="flowStartTime"    column="flow_start_time"    />
        <result property="flowEndTime"    column="flow_end_time"    />
        <result property="status"    column="status"    />
        <result property="flowDesc"    column="flow_desc"    />
        <result property="taxSourceId"    column="tax_source_id"    />
        <result property="providerId"    column="provider_id"    />
        <result property="reservedFieldOne"    column="reserved_field_one"    />
        <result property="reservedFieldTwo"    column="reserved_field_two"    />
        <result property="reservedFieldThree"    column="reserved_field_three"    />
        <result property="reservedFieldFour"    column="reserved_field_four"    />
        <result property="reservedFieldFive"    column="reserved_field_five"    />
        <result property="delStatus"    column="del_status"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
    </resultMap>
    <select id="seletByFlowId" resultMap="EsignFlowResult">
        select * from tbl_esign_flow
        where flow_id = #{flowId}
    </select>

    <select id="getManagerAgreementInfoDTO" resultType="com.mmtax.business.dto.ManagerAgreementInfoDTO">
    SELECT
        t1.NAME AS NAME,
        t1.id_number AS payeeIdCardNo,
        t3.merchant_name AS merchantName,
	    DATE_FORMAT( t1.create_time, '%Y年%m月%d日' ) AS signTime
    FROM
	    tbl_customer_esign_info t1
        LEFT JOIN tbl_customer_protocol t2 ON t1.id = t2.cus_esign_id
        LEFT JOIN tbl_merchant_info t3 ON t2.merchant_id = t3.id
    WHERE
	    t1.id_number = #{idNumber}
	AND t2.tax_source_id = #{taxSourceId}
	AND t2.sign_status = 2
    ORDER BY
        t1.create_time
        LIMIT 1
    </select>
</mapper>