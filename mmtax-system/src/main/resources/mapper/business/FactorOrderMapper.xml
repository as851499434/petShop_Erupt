<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mmtax.business.mapper.FactorOrderMapper">

    <resultMap type="FactorOrder" id="FactorOrderResult">
        <result property="id" column="id"/>
        <result property="orderNo" column="order_no"/>
        <result property="orderNum" column="order_num"/>
        <result property="serviceAmount" column="service_amount"/>
        <result property="offsetAmount" column="offset_amount"/>
        <result property="totalAmount" column="total_amount"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="providerId" column="provider_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <select id="getListFactorOrder" resultType="com.mmtax.business.dto.MerchantFactorListDTO">
        select
        t1.id as id,
        t1.order_no as orderNo,
        t1.order_num as orderNum,
        t1.service_amount as serviceAmount,
        t1.offset_amount as offsetAmount,
        t1.total_amount as totalAmount,
        t1.create_time as createTime,
        t2.merchant_name as merchantName
        from
        tbl_factor_order t1,
        tbl_merchant_info t2
        where
        1=1
        and
        t1.merchant_id = t2.id
        and
        t1.merchant_id=#{merchantId}
        <if test="orderNo != null and orderNo != ''">
            and t1.order_no like concat('%',#{orderNo},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate}, ' 23:59:59')
        </if>
        order by
        t1.create_time desc
        <if test="startIndex != null">
            limit #{startIndex},#{pageSize}
        </if>
    </select>
    <select id="getCountFactorOrder" resultType="java.lang.Integer">
        select
        count(0)
        from
        tbl_factor_order t1,
        tbl_merchant_info t2
        where
        1=1
        and
        t1.merchant_id = t2.id
        and
        t1.merchant_id=#{merchantId}
        <if test="orderNo != null and orderNo != ''">
            and t1.order_no like concat('%',#{orderNo},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate}, ' 23:59:59')
        </if>
    </select>


</mapper>