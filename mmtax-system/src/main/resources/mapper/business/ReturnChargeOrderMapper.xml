<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mmtax.business.mapper.ReturnChargeOrderMapper">
    

    <resultMap type="com.mmtax.business.domain.ReturnChargeOrder" id="ReturnChargeOrderResult">


        <result property="id"    column="id"    />
        <result property="returnSerialNum"    column="return_serial_num"    />
        <result property="orderSerialNum"    column="order_serial_num"    />
        <result property="status"    column="status"    />
        <result property="returnCharge"    column="return_charge"    />
        <result property="merchantId"    column="merchant_id"    />
        <result property="customerId"    column="customer_id"    />
        <result property="asyncStatus"    column="async_status"    />
        <result property="comment"    column="comment"    />
        <result property="providerId"    column="provider_id"    />
        <result property="reservedFieldOne"    column="reserved_field_one"    />
        <result property="reservedFieldTwo"    column="reserved_field_two"    />
        <result property="reservedFieldThree"    column="reserved_field_three"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
    </resultMap>


    <select id="listReturnOrders" resultType="com.mmtax.business.dto.ReturnMakeUpChargeOrderDTO">

        SELECT
        t2.payee_name as payeeName,
        t2.payee_bank_card as payeeBankCard,
        t2.amount as amount,
        t1.return_charge as returnMakeupCharge,
        t1.return_serial_num as returnMakeupSerialNum,
        t2.order_serial_num as orderSerialNum,
        t1.create_time as createTime

        FROM tbl_return_charge_order AS t1 LEFT JOIN
            tbl_trx_order AS t2
           ON t1.order_serial_num = t2.order_serial_num
        WHERE t2.merchant_id = #{merchantId}
        <if test="payeeName != null and payeeName != ''">
            and t2.payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="payeeBankCard != null and payeeBankCard != ''">
            and t2.payee_bank_card like concat('%',#{payeeBankCard},'%')
        </if>
        <if test="returnSerialNum != null and returnSerialNum != ''">
            and t1.return_serial_num like concat('%',#{returnSerialNum},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and t1.order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        order by
        t1.create_time desc
        <if test="pageSize != null">
            limit #{startIndex},#{pageSize}
        </if>


    </select>



    <select id="countReturnOrders" resultType="java.lang.Integer">

        SELECT count(*)
        FROM tbl_return_charge_order AS t1 LEFT JOIN
        tbl_trx_order AS t2
        ON t1.order_serial_num = t2.order_serial_num
        WHERE t2.merchant_id = #{merchantId}
        <if test="payeeName != null and payeeName != ''">
            and t2.payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="payeeBankCard != null and payeeBankCard != ''">
            and t2.payee_bank_card like concat('%',#{payeeBankCard},'%')
        </if>

        <if test="returnSerialNum != null and returnSerialNum != ''">
            and t1.return_serial_num like concat('%',#{returnSerialNum},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and t1.order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        order by
        t1.create_time desc
    </select>
    <select id="selectByOrderSerialNumOrReturnSerialNum" resultMap="ReturnChargeOrderResult">
        select * from tbl_return_charge_order
        where 1 = 1
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and order_serial_num = #{orderSerialNum}
        </if>
        <if test="returnSerialNum != null and returnSerialNum != ''">
            and return_serial_num = #{returnSerialNum}
        </if>
    </select>
    <select id="selectByStatusAndAsycSatus" resultMap="ReturnChargeOrderResult">
        select * from tbl_return_charge_order
        where 1 = 1
        <if test="status != null">
            and status = #{status}
        </if>
        <if test="asyncStatus != null">
            and async_status = #{asyncStatus}
        </if>
    </select>
</mapper>