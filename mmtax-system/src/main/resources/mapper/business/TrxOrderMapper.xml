<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mmtax.business.mapper.TrxOrderMapper">

    <resultMap type="com.mmtax.business.domain.TrxOrder" id="TrxOrderResult">
        <result property="id" column="id"/>
        <result property="merchantName" column="merchant_name"/>
        <result property="amount" column="amount"/>
        <result property="taxRate" column="tax_rate"/>
        <result property="charge" column="charge"/>
        <result property="inOutDeduction" column="in_out_deduction"/>
        <result property="trxRateBig" column="trx_rate_big"/>
        <result property="chargeBig" column="charge_big"/>
        <result property="bigInOutDeduction" column="big_in_out_deduction"/>
        <result property="actualAmount" column="actual_amount"/>
        <result property="orderSerialNum" column="order_serial_num"/>
        <result property="merchantSerialNum" column="merchant_serial_num"/>
        <result property="batchNo" column="batch_no"/>
        <result property="paymentVoucher" column="payment_voucher"/>
        <result property="payeeName" column="payee_name"/>
        <result property="payeeMobile" column="payee_mobile"/>
        <result property="payeeBankCard" column="payee_bank_card"/>
        <result property="bankName" column="bank_name"/>
        <result property="payeeIdCardNo" column="payee_id_card_no"/>
        <result property="orderStatus" column="order_status"/>
        <result property="batchPaymentRecordId" column="batch_payment_record_id"/>
        <result property="paymentChannel" column="payment_channel"/>
        <result property="bankId" column="bank_id"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="customerId" column="customer_id"/>
        <result property="subjectConscription" column="subject_conscription"/>
        <result property="remark" column="remark"/>
        <result property="comment" column="comment"/>
        <result property="orderInfo" column="order_info"/>
        <result property="asyncStatus" column="async_status" />
        <result property="useBigRate" column="use_big_rate" />
        <result property="needPayCard" column="need_pay_card" />
        <result property="taskRecordBatchNo"    column="task_record_batch_no"    />
        <result property="memo"    column="memo"    />
        <result property="providerId" column="provider_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <resultMap type="com.mmtax.business.dto.TrxOrderDTO" id="TrxOrderDetailResult">
        <result property="id" column="id"/>
        <result property="merchantName" column="merchant_name"/>
        <result property="amount" column="amount"/>
        <result property="taxRate" column="tax_rate"/>
        <result property="charge" column="charge"/>
        <result property="inOutDeduction" column="in_out_deduction"/>
        <result property="trxRateBig" column="trx_rate_big"/>
        <result property="chargeBig" column="charge_big"/>
        <result property="bigInOutDeduction" column="big_in_out_deduction"/>
        <result property="actualAmount" column="actual_amount"/>
        <result property="orderSerialNum" column="order_serial_num"/>
        <result property="merchantSerialNum" column="merchant_serial_num"/>
        <result property="batchNo" column="batch_no"/>
        <result property="paymentVoucher" column="payment_voucher"/>
        <result property="payeeName" column="payee_name"/>
        <result property="payeeMobile" column="payee_mobile"/>
        <result property="payeeBankCard" column="payee_bank_card"/>
        <result property="bankName" column="bank_name"/>
        <result property="payeeIdCardNo" column="payee_id_card_no"/>
        <result property="orderStatus" column="order_status"/>
        <result property="batchPaymentRecordId" column="batch_payment_record_id"/>
        <result property="paymentChannel" column="payment_channel"/>
        <result property="merchantId" column="merchant_id"/>
        <result property="merchantCode" column="merchant_code"/>
        <result property="comment" column="comment"/>
        <result property="useBigRate" column="use_big_rate" />
        <result property="needPayCard" column="need_pay_card" />
        <result property="providerId" column="provider_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <select id="selectCreateTimeAndPidByorderSerialNum" resultType="com.mmtax.business.dto.DownloadCredentialDTO">

    SELECT t1.`create_time` AS createTime,
    t3.`pid` AS Pid
    FROM tbl_trx_order AS t1 LEFT JOIN tbl_online_payment_info AS t2 ON t1.`merchant_id` = t2.`merchant_id`
    LEFT JOIN tbl_online_account_config AS t3 ON t2.`tax_source_company_id` = t3.`tax_sounrce_id`
    WHERE t1.`order_serial_num` = #{orderSerialNum}
    </select>

    <select id="listTrxOrders" resultType="com.mmtax.business.dto.ListTrxOrdersDTO">
        select
        id,
        merchant_name as merchantName,
        tax_rate as taxRate,
        charge as charge,
        in_out_deduction as inOutDeduction,
        trx_rate_big as trxRateBig,
        charge_big as chargeBig,
        big_in_out_deduction as bigInOutDeduction,
        actual_amount as actualAmount,
        order_serial_num as orderSerialNum,
        merchant_serial_num as merchantSerialNum,
        batch_no as batchNo,
        payment_voucher as paymentVoucher,
        payee_name as payeeName,
        payee_mobile as payeeMobile,
        payee_bank_card as payeeBankCard,
        bank_name as bankName,
        payee_id_card_no as payeeIdCardNo,
        order_status as orderStatus,
        batch_payment_record_id as batchPaymentRecordId,
        payment_channel as paymentChannel,
        bank_id as bankId,
        merchant_id as merchantId,
        customer_id as customerId,
        subject_conscription as subjectConscription,
        remark as remark,
        comment as comment,
        order_info as orderInfo,
        async_status as asyncStatus,
        use_big_rate as useBigRate,
        create_time as createTime,
        update_time as updateTime,
        amount as payAmount
        from
        tbl_trx_order
        where
        merchant_id = #{merchantId} and order_status != 4
        <if test="merchantName != null and merchantName != ''">
            and merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="merchantSerialNum != null and merchantSerialNum != ''">
            and merchant_serial_num like concat('%',#{merchantSerialNum},'%')
        </if>
        <if test="payeeBankCard != null and payeeBankCard != ''">
            and payee_bank_card like concat('%',#{payeeBankCard},'%')
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
            and payee_id_card_no like concat('%',#{payeeIdCardNo},'%')
        </if>
        <if test="orderStatus != null">
            and order_status = #{orderStatus}
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="paymentChannel != null and paymentChannel != ''">
            and payment_channel like concat('%',#{paymentChannel},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        order by
        create_time desc
        <if test="pageSize != null">
            limit #{startIndex},#{pageSize}
        </if>

    </select>
    <select id="countTrxOrders" resultType="java.lang.Integer">
        select
        COUNT(*)
        from
        tbl_trx_order
        where
        merchant_id = #{merchantId} and order_status != 4

        <if test="merchantName != null and merchantName != ''">
            and merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="merchantSerialNum != null and merchantSerialNum != ''">
            and merchant_serial_num like concat('%',#{merchantSerialNum},'%')
        </if>
        <if test="payeeBankCard != null and payeeBankCard != ''">
            and payee_bank_card like concat('%',#{payeeBankCard},'%')
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
            and payee_id_card_no like concat('%',#{payeeIdCardNo},'%')
        </if>
        <if test="orderStatus != null">
            and order_status = #{orderStatus}
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="paymentChannel != null and paymentChannel != ''">
            and payment_channel like concat('%',#{paymentChannel},'%')
        </if>


        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        order by
        create_time desc
    </select>

    <select id="getListTrxOrderOfSource" parameterType="com.mmtax.business.dto.ManagerTrxOrderDTO"
            resultType="com.mmtax.business.dto.ManagerTrxOrderDTO">
        select
        t1.id as id,
        t1.payee_name as payeeName,
        t1.amount as amount,
        t1.order_serial_num as orderSerialNum,
        t1.merchant_serial_num as merchantSerialNum,
        t1.create_time as createTime,
        t1.update_time as updateTime,
        t1.merchant_id as merchantId,
        t1.payment_channel as paymentChannel,
        t1.batch_no as batchNo,
        t1.payee_bank_card as payeeBankNo,
        t1.bank_name as bankName,
        t1.payee_id_card_no as payeeIdCardNo,
        t1.payee_mobile as payeeMobile,
        t1.charge as charge,
        t1.actual_amount as actualAmount,
        t1.order_status as orderStatus,
        t1.comment as comment,
        t2.merchant_name as merchantName,
        t3.user_name as saleName,
        t4.company_name as accountName,
        t4.tax_source_name as taxSourceName
        from
        tbl_trx_order t1 left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join
        sys_user t3 on t2.belong_saler = t3.user_id
        left join tbl_tax_withdraw_account t4
        on t1.merchant_id = t4.charge_merchant_id
        where
        1=1
        and t1.merchant_id in (select t5.charge_merchant_id from tbl_tax_withdraw_account t5)
<!--        <foreach collection="chargeMerIds" item="id" index="index" open="(" close=")" separator=",">-->
<!--            #{id}-->
<!--        </foreach>-->
        <if test="startDate != null and startDate !='' and endDate != null and endDate != ''">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        <if test="merchantName != null and merchantName != ''">
            and t2.merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and t1.order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="orderStatus != null and orderStatus != ''">
            and t1.order_status = #{orderStatus}
        </if>
        <if test="paymentChannel != null and paymentChannel != ''">
            and t1.payment_channel = #{paymentChannel}
        </if>
        <if test="saleName != null and saleName != ''">
            and t3.user_name like concat('%',#{saleName},'%')
        </if>
        <if test="saleId != null and saleId != ''">
            and t2.belong_saler = #{saleId}
        </if>
        order by
        t1.create_time desc
    </select>


    <select id="returnListTrxOrder" parameterType="com.mmtax.business.dto.ManagerReturnListTrxOrderDTO"
            resultType="com.mmtax.business.dto.ManagerReturnListTrxOrderDTO">
        SELECT
        t2.payee_name AS payeeName,
        t2.payee_bank_card AS payeeBankNo,
        t2.merchant_name AS merchantName,
        t2.amount AS amount,
        t1.return_charge AS returnCharge,
        t1.status as status,
        t1.return_serial_num AS returnSerialNum,
        t1.order_serial_num as orderSerialNum,
        t1.create_time AS createTime
        FROM
            tbl_return_charge_order t1
        LEFT JOIN tbl_trx_order t2 ON t2.order_serial_num = t1.order_serial_num
        <where>
            <if test="startDate != null and startDate !='' and endDate != null and endDate != ''">
                and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
            </if>
            <if test="payeeName != null and payeeName != ''">
                and t2.payee_name like concat('%',#{payeeName},'%')
            </if>
        </where>
        ORDER BY
        t1.create_time DESC
    </select>

    <select id="makeUpListTrxOrder" parameterType="com.mmtax.business.dto.ManagerMakeUpListTrxOrderDTO"
            resultType="com.mmtax.business.dto.ManagerMakeUpListTrxOrderDTO">
        select
        t2.payee_name AS payeeName,
        t2.payee_bank_card AS payeeBankNo,
        t2.merchant_name AS merchantName,
        t2.amount AS amount,
        t1.charge_make_up as chargeMakeUp,
        t3.make_up_serial_num as makeUpSerialNum,
        t1.order_serial_num as orderSerialNum,
        t3.`status` as status,
        t1.create_time as createTime
        FROM
        tbl_make_up_charge t3
        LEFT JOIN tbl_make_up_charge_detail t1 ON t3.id = t1.make_up_charge_id
        LEFT JOIN tbl_trx_order t2 ON t3.order_serial_num = t2.order_serial_num
        <where>
            <if test="startDate != null and startDate !='' and endDate != null and endDate != ''">
                and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
            </if>
            <if test="payeeName != null and payeeName != ''">
                and t2.payee_name like concat('%',#{payeeName},'%')
            </if>
        </where>
        ORDER BY
        t1.create_time DESC
    </select>

    <select id="getListTrxOrder" parameterType="com.mmtax.business.dto.ManagerTrxOrderDTO"
            resultType="com.mmtax.business.dto.ManagerTrxOrderDTO">
        select
        t1.id as id,
        t1.payee_name as payeeName,
        t1.amount as amount,
        t1.order_serial_num as orderSerialNum,
        t1.merchant_serial_num as merchantSerialNum,
        t1.create_time as createTime,
        t1.update_time as updateTime,
        t1.merchant_id as merchantId,
        t1.payment_channel as paymentChannel,
        t1.batch_no as batchNo,
        t1.payee_bank_card as payeeBankNo,
        t1.bank_name as bankName,
        t1.payee_id_card_no as payeeIdCardNo,
        t1.payee_mobile as payeeMobile,
        t1.charge as charge,
        t1.actual_amount as actualAmount,
        t1.order_status as orderStatus,
        t1.comment as comment,
        t2.merchant_name as merchantName,
        t3.user_name as saleName,
        t2.subject AS subject
        from
        tbl_trx_order t1 left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join
        sys_user t3 on t2.belong_saler = t3.user_id
        where
        1=1 and t1.order_status != 4
        <if test="payeeName != null and payeeName != ''">
            and t1.payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="startDate != null and startDate !='' and endDate != null and endDate != ''">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        <if test="merchantName != null and merchantName != ''">
            and t2.merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and t1.order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="orderStatus != null and orderStatus != ''">
            and t1.order_status = #{orderStatus}
        </if>
        <if test="paymentChannel != null and paymentChannel != ''">
            and t1.payment_channel = #{paymentChannel}
        </if>
        <if test="saleName != null and saleName != ''">
            and t3.user_name like concat('%',#{saleName},'%')
        </if>
        <if test="saleId != null and saleId != ''">
            and t2.belong_saler = #{saleId}
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
        order by
        t1.create_time desc
    </select>

    <select id="getListDetail" resultType="com.mmtax.business.dto.MerchantBatchPaymentDetailDTO">
        select
        t1.id as id,
        t1.payee_name as payeeName,
        t2.amount as amount,
        t2.order_serial_num as orderSerialNum,
        t1.merchant_serial_num as merchantSerialNum,
        t1.create_time as createTime,
        t1.update_time as updateTime,
        t1.merchant_id as merchantId,
        t1.payment_channel as paymentChannel,
        t2.batch_no as batchNo,
        t1.payee_bank_card as payeeBankNo,
        t1.bank_name as bankName,
        t1.payee_id_card_no as payeeIdCardNo,
        t1.payee_mobile as payeeMobile,
        t1.comment as comment,
        t2.charge as charge,
        t2.actual_amount as actualAmount,
        t1.order_status as orderStatus,
        t1.use_big_rate as useBigRate,
        t1.charge_big as chargeBig
        from
        tbl_batch_payment_detail t2
        left join tbl_trx_order t1 on t1.order_serial_num = t2.order_serial_num
        where
        1=1 and t1.order_status != 4
        and t2.batch_payment_record_id = #{id}
        order by t1.create_time desc
        <if test="startIndex != null">
            limit #{startIndex},#{pageSize}
        </if>
    </select>

    <select id="getCountDetail" resultType="java.lang.Integer">
        select count(0)
        from tbl_trx_order t1
        where 1 = 1
          and t1.batch_payment_record_id = #{id}
    </select>

    <select id="getSumAmountByRecordId" resultType="java.math.BigDecimal">
        select sum(amount)
        from tbl_trx_order
        where 1 = 1
          and batch_payment_record_id = #{id}

          <if test="orderStatus != null" >
              and order_status = #{orderStatus}
          </if>
    </select>

    <select id="getCountByRecordId" resultType="java.lang.Integer">
        select count(0)
        from tbl_trx_order
        where 1 = 1
          and batch_payment_record_id = #{id}
         <if test="orderStatus != null " >
             and order_status = #{orderStatus}
        </if>
    </select>

    <select id="getSumCharge" resultType="java.math.BigDecimal">
        select sum(
            case use_big_rate
			when 0 then charge
			else charge_big
			end
		)
        from tbl_trx_order
        where 1 = 1 and batch_payment_record_id = #{id}
        and (order_status = '1' or order_status = '0' or order_status = '-1')
    </select>
    <select id="getTrxDetail" resultMap="TrxOrderDetailResult">
        SELECT o.*,
               i.merchant_code
        FROM tbl_trx_order o
                 LEFT JOIN
             tbl_merchant_info i
             ON
                 o.merchant_id = i.id
        WHERE o.id = #{id}
    </select>
    <select id="listSysTrxOrders" resultType="com.mmtax.business.dto.SysTrxOrderDTO">
        select
        id as id,
        amount as amount,
        order_serial_num as orderSerialNum,
        merchant_serial_num as merchantSerialNum,
        update_time as createTime,
        payment_channel as paymentChannel,
        batch_no as batchNo,
        payee_bank_card as payeeBankNo,
        bank_name as bankName,
        payee_id_card_no as payeeIdCardNo,
        payee_mobile as payeeMobile,
        charge as charge,
        actual_amount as actualAmount,
        order_status as orderStatus,
        merchant_name as merchantName
        from
        tbl_trx_order
        where
        1=1
        <if test="startDate != null and startDate !='' and endDate != null and endDate != ''">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        <if test="merchantName != null and merchantName != ''">
            and merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="orderStatus != null and orderStatus != ''">
            and order_status = #{orderStatus}
        </if>
        order by
        create_time desc
    </select>
    <select id="getVoucher" resultType="com.mmtax.business.dto.ElectronicVoucherDTO">
        SELECT right(t1.order_serial_num, 4) as electronicCode,
               t1.create_time                AS createTime,
               t2.merchant_name              AS merchantName,
               t2.merchant_code              AS merchantCode,
               t1.payee_name                 AS payeeName,
               t1.payee_bank_card            AS payeeBankCard,
               t1.bank_name                  AS bankName,
               t1.order_serial_num           AS orderSerialNum,
               t1.amount                     AS amount,
               t1.merchant_serial_num        AS merchantSerialNum,
               t1.order_status               AS orderStatus
        FROM tbl_trx_order t1
                 LEFT JOIN
             tbl_merchant_info t2
             ON
                 t1.merchant_id = t2.id
        WHERE t1.id = #{id}
    </select>

    <select id="orderNum" resultType="java.lang.Integer">
        select
        count(0)
        from
        tbl_trx_order
        where
        1=1
        and
        order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
    </select>
    <select id="getChannelPaymentBySaler" resultType="com.mmtax.business.dto.ManagerIndexPaymentDTO">
        select t4.*,t5.*,t6.*
        from
        (
        select
        sum(t1.amount) as bankAmount
        from
        tbl_trx_order t1
        left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        where
        1=1
        and
        t1.payment_channel = 'BANK'
        and
        t1.order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        ${params.dataScope}
        ) t4,
        (
        select
        sum(t1.amount) as aLiPayAmount
        from
        tbl_trx_order t1
        left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        where
        1=1
        and
        t1.payment_channel = 'ALIPAY'
        and
        t1.order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        ${params.dataScope}
        ) t5,
        (
        select
        sum(t1.amount) as weChatAmount
        from
        tbl_trx_order t1
        left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        where
        1=1
        and
        t1.payment_channel = 'WECHAT'
        and
        t1.order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        ${params.dataScope}
        ) t6
    </select>
    <select id="getSumAmount" resultType="java.math.BigDecimal">
        select
        sum(amount)
        from
        tbl_trx_order
        where
        1=1
        and
        order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != '' ">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
    </select>

    <select id="getMonthAmount" resultType="com.mmtax.business.dto.ManagerIndexYearDataDTO">
        select sum(t1.amount)        as amount,
               month(t1.create_time) as month
        from tbl_trx_order t1
        where 1 = 1
          and order_status = '1'
          and year(t1.create_time) = year(now())
        group by month(t1.create_time)
    </select>
    <select id="getSumAmountByMerchantIdCustomerId" resultType="java.math.BigDecimal">
        select
        <if test="merchantId != null">
        sum(amount)
        </if>
        <if test="customerId != null">
        sum(actual_amount)
        </if>
        from tbl_trx_order
        where 1 = 1
        <if test="merchantId != null">
            and merchant_id = #{merchantId}
        </if>
        <if test="customerId != null">
            and customer_id = #{customerId}
        </if>
        and order_status = '1'
        and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
    </select>
    <select id="getSumTaxAmountByMerchantId" resultType="java.math.BigDecimal">
        select sum(charge)
        from tbl_trx_order
        where merchant_id = #{merchantId}
          and order_status = '1'
          and create_time
            between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
    </select>
    <select id="getMerchantMonthPaymentDetail" resultType="com.mmtax.business.dto.PayTrendDTO">
        select sum(amount) as paymentAmount, concat(YEAR(create_time), '-', month(create_time)) as monthNo
        from tbl_trx_order
        where merchant_id = #{merchantId}
          and order_status = '1'
          and create_time BETWEEN concat(#{startDate}, '-01 00:00:00') and concat(#{endDate}, '-31 23:59:59')
        group by MONTH(create_time)
    </select>
    <select id="getMerchantDayPaymentDetail" resultType="com.mmtax.business.dto.DayPayTrendDTO">
        select sum(amount) as amount, DATE_FORMAT(create_time, '%Y-%m-%d') as date
        from tbl_trx_order
        where merchant_id = #{merchantId}
          and order_status = '1'
          and create_time BETWEEN concat(#{startDate}, ' 00:00:00') and concat(#{endDate}, ' 23:59:59')
        group by DAY(create_time)
        order by create_time asc
    </select>
    <select id="getMerchantStatisticalOrderCount"
            resultType="com.mmtax.business.dto.MerchantStatisticalDataDTO">
        select sum((if((order_status = 0), 1, 0))) as unFinishOrderCount,
        sum((if((order_status = 1 or order_status = 2 or order_status = 3 or order_status = 0), 1,
        0))) as sumOrderCount,
        sum((if((order_status = 1), 1, 0))) as successOrderCount,
        sum((if((order_status = 2 or order_status = 3), 1, 0))) as failOrderCount
        from tbl_trx_order
        where 1 = 1
        and merchant_id = #{merchantId}
        <if test="merchantName != null and merchantName != ''">
            and merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="merchantSerialNum != null and merchantSerialNum != ''">
            and merchant_serial_num like concat('%',#{merchantSerialNum},'%')
        </if>
        <if test="payeeBankCard != null and payeeBankCard != ''">
            and payee_bank_card like concat('%',#{payeeBankCard},'%')
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
            and payee_id_card_no like concat('%',#{payeeIdCardNo},'%')
        </if>
        <if test="orderStatus != null">
            and order_status = #{orderStatus}
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
    </select>

    <select id="getMerchantStatisticalOrderAmount"
            resultType="com.mmtax.business.dto.MerchantStatisticalDataDTO">
        select sum(if((order_status = 0), amount, 0)) as unFinishOrderAmount,
        sum(if((order_status = 1 or order_status = 2 or order_status = 3 or order_status = 0), amount,
        0)) as sumOrderAmount,
        sum(if((order_status = 1), amount, 0)) as successOrderAmount,
        sum(if((order_status = 2 or order_status = 3), amount, 0)) as failOrderAmount
        from tbl_trx_order
        where 1 = 1
        and merchant_id = #{merchantId}
        <if test="merchantName != null and merchantName != ''">
            and merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="orderSerialNum != null and orderSerialNum != ''">
            and order_serial_num like concat('%',#{orderSerialNum},'%')
        </if>
        <if test="merchantSerialNum != null and merchantSerialNum != ''">
            and merchant_serial_num like concat('%',#{merchantSerialNum},'%')
        </if>
        <if test="payeeBankCard != null and payeeBankCard != ''">
            and payee_bank_card like concat('%',#{payeeBankCard},'%')
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
            and payee_id_card_no like concat('%',#{payeeIdCardNo},'%')
        </if>
        <if test="orderStatus != null">
            and order_status = #{orderStatus}
        </if>
        <if test="payeeName != null and payeeName != ''">
            and payee_name like concat('%',#{payeeName},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
    </select>

    <select id="getMerchantStatisticalOrderCharge" resultType="java.math.BigDecimal">
        select sum(result) from
        (
            select case when charge_big is not null then charge_big else charge end as result
            from tbl_trx_order
            where merchant_id = #{merchantId}
            and order_status = 1
            <if test="merchantName != null and merchantName != ''">
                and merchant_name like concat('%',#{merchantName},'%')
            </if>
            <if test="orderSerialNum != null and orderSerialNum != ''">
                and order_serial_num like concat('%',#{orderSerialNum},'%')
            </if>
            <if test="merchantSerialNum != null and merchantSerialNum != ''">
                and merchant_serial_num like concat('%',#{merchantSerialNum},'%')
            </if>
            <if test="payeeBankCard != null and payeeBankCard != ''">
                and payee_bank_card like concat('%',#{payeeBankCard},'%')
            </if>
            <if test="payeeName != null and payeeName != ''">
                and payee_name like concat('%',#{payeeName},'%')
            </if>
            <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
                and payee_id_card_no like concat('%',#{payeeIdCardNo},'%')
            </if>
            <if test="orderStatus != null">
                and order_status = #{orderStatus}
            </if>
            <if test="payeeName != null and payeeName != ''">
                and payee_name like concat('%',#{payeeName},'%')
            </if>
            <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
                and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
            </if>
        )a
    </select>
    <select id="getSumAmountBySale"  parameterType="com.mmtax.business.dto.SysUserDTO" resultType="java.math.BigDecimal">
        select sum(t1.amount)
        from tbl_trx_order t1
        left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        where
        1=1
        and t1.order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between #{startDate} and #{endDate}
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
    </select>
    <select id="getSumChargeBySale" parameterType="com.mmtax.business.dto.SysUserDTO"  resultType="java.math.BigDecimal">
        select sum(t1.charge)
        from tbl_trx_order t1
        left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        where
        1=1
        and order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between #{startDate} and #{endDate}
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}

    </select>
    <select id="getCountOrderBySale" parameterType="com.mmtax.business.dto.SysUserDTO"  resultType="java.lang.Integer">
        select count(0)
        from tbl_trx_order t1
        left join
        tbl_merchant_info t2
        on
        t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        where
        1=1
        and order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between #{startDate} and #{endDate}
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
    </select>

    <select id="sumAmountByPayeeIdCardNo" resultType="java.math.BigDecimal">
        select IFNULL(SUM(t1.amount),0)
        from tbl_trx_order t1
        where
        1=1
        and t1.order_status != 4 and t1.order_status != 9
        <if test="merchantId != null">
            and t1.merchant_id = #{merchantId}
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between #{startDate} and #{endDate}
        </if>
        <if test="payeeIdCardNo != null">
            and t1.payee_id_card_no = #{payeeIdCardNo}
        </if>
    </select>

    <select id="sumAmountByCustomerId" resultType="java.math.BigDecimal">
        select IFNULL(SUM(t1.amount),0)
        from tbl_trx_order t1
        where
        1=1
        and t1.order_status != 4 and t1.order_status != 9
        <if test="merchantId != null">
            and t1.merchant_id = #{merchantId}
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between #{startDate} and #{endDate}
        </if>
        <if test="customerId != null">
            and t1.customer_id = #{customerId}
        </if>
    </select>

    <select id="getMerchantMonthPaidStatistics"   parameterType="com.mmtax.business.dto.SysUserDTO"  resultType="com.mmtax.business.dto.MangerMerchantStatisticsDTO">
        SELECT
        sum( t1.amount ) AS amount,
        t2.merchant_name AS merchantName,
        DATE_FORMAT(t1.create_time,'%Y-%m-%d') as date
        FROM
        tbl_trx_order t1
        LEFT JOIN tbl_merchant_info t2 ON t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        WHERE
        1 = 1
        AND order_status = '1'
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between #{startDate} and #{endDate}
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}

        GROUP BY DATE_FORMAT(t1.create_time,'%Y-%m-%d'),t1.merchant_id
    </select>
    <select id="getMerchantYearPaidStatistics"  parameterType="com.mmtax.business.dto.SysUserDTO" resultType="com.mmtax.business.dto.MangerMerchantStatisticsDTO">
        SELECT
        sum( t1.amount ) AS amount,
        t2.merchant_name AS merchantName,
        DATE_FORMAT(t1.create_time,'%Y-%m') as date
        FROM
        tbl_trx_order t1
        LEFT JOIN tbl_merchant_info t2 ON t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        WHERE
        1 = 1
        AND order_status = '1'
        <if test="selectDate != null and selectDate != ''">
            and year(t1.create_time) = #{selectDate}
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
        GROUP BY DATE_FORMAT(t1.create_time,'%Y-%m'),t1.merchant_id
    </select>
    <select id="getSaleStatistic" parameterType="com.mmtax.business.dto.ManagerSaleStatisticDTO"
            resultType="com.mmtax.business.dto.ManagerSaleStatisticDTO">
            select sum(t1.actual_amount) as amount,
        sum(
        CASE t1.use_big_rate
        WHEN 1 THEN t1.charge_big
        ELSE t1.charge
        END) as charge,
        t2.merchant_name as merchantName,
        t2.merchant_code as merchantCode,
        t2.contacts_mobile as mobile,
        t3.user_name as saleName,
        t5.tax_sounrce_company_name as taxSourceName
        from tbl_trx_order t1
        left join tbl_merchant_info t2
        on t1.merchant_id = t2.id
        left join sys_user t3
        on
        t2.belong_saler = t3.user_id
        left join tbl_online_payment_info t4 on t4.merchant_id = t2.id
        left join tbl_tax_sounrce_company t5 on t5.id = t4.tax_source_company_id
        where 1=1
        and t1.order_status = '1'
        <if test="saleId != null and saleId != ''">
            and t2.belong_saler = #{saleId}
        </if>
        <if test="saleName != null and saleName != ''">
            and t3.user_name like concat('%',#{saleName},'%')
        </if>
        <if test="merchantName != null and merchantName != ''">
            and t2.merchant_name like concat('%',#{merchantName},'%')
        </if>
        <if test="merchantCode != null and merchantCode != ''">
            and t2.merchant_code like concat('%',#{merchantCode},'%')
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and t1.create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
        group by t2.id
        order by t2.id desc
    </select>

    <select id="getCountByMerchantSerialNum" resultType="java.lang.Integer">
        select count(*)
        from tbl_trx_order
        where merchant_id = #{merchantId}
          and merchant_serial_num = #{merchantTrxOrderNo}
    </select>
    <select id="selectInOrderSerialNums" resultMap="TrxOrderResult">
        select * from tbl_trx_order where
        order_serial_num in
        <foreach collection="orderSerialNums" item="orderSerialNum" index="index" open="(" close=")" separator=",">
            #{orderSerialNum}
        </foreach>
    </select>
    <select id="selectByOrderSerialNum" resultMap="TrxOrderResult">
        select * from tbl_trx_order where
        order_serial_num = #{orderSerialNum}
    </select>
    <select id="selectByMerchantSerialNum" resultMap="TrxOrderResult">
        select * from tbl_trx_order
        where order_status != 4
        and merchant_serial_num = #{merchantSerialNum}
    </select>
    <select id="selectByStatusList" resultMap="TrxOrderResult">
        select * from tbl_trx_order where
        (order_status = -1 or order_status = 0)
        and create_time &lt; #{createTime}
    </select>
    <select id="selectStatusSuccessOrFail" resultMap="TrxOrderResult">
        select * from tbl_trx_order where async_status = 0
    </select>
    <select id="selectByOrderStatusAsyncStatus" resultMap="TrxOrderResult">
        select * from tbl_trx_order
        where 1 = 1
        <if test="orderStatus != null">
            and order_status = #{orderStatus}
        </if>
        <if test="asyncStatus != null">
            and async_status = #{asyncStatus}
        </if>
    </select>
    <select id="selectByStatusInOneMonth" resultMap="TrxOrderResult">
        select * from tbl_trx_order t1
        left join tbl_online_payment_info t2 on t1.merchant_id = t2.merchant_id
        where
        t1.order_status in
        <foreach collection="statusList" item="status" index="index" open="(" close=")" separator=",">
            #{status}
        </foreach>
        <if test="merchantId != null">
            and t1.merchant_id = #{merchantId}
        </if>
        <if test="taxSourceId != null">
            and t2.tax_source_company_id = #{taxSourceId}
        </if>
        <if test="customerId != null">
            and t1.customer_id = #{customerId}
        </if>
        <if test="idCardNo != null and idCardNo != ''">
            and t1.payee_id_card_no = #{idCardNo}
        </if>
        and t1.create_time between #{startTime} and #{endTime}
    </select>
    <select id="selectByMonthAndBigRate" resultMap="TrxOrderResult">
        select * from tbl_trx_order
        where (order_status = -1 or order_status = 0 or order_status = 1)
        and use_big_rate = 1
        and create_time between #{beginTime} and #{endTime}
    </select>
    <select id="countSuccess" resultType="java.lang.Integer">
        SELECT count(0)
        FROM `tbl_trx_order`
        where merchant_id = #{merchatId} and batch_no = #{batchNo} and order_status in (1,9)

    </select>

    <select id="selectByCustomerIdAndStatusAndUseBigRate" resultMap="TrxOrderResult">
        select * from tbl_trx_order
        where customer_id = #{customerId} and merchant_id = #{merchantId}
        and order_status = #{status}
        and use_big_rate = #{useBigRate}
    </select>
    <select id="listPageByCustomerIdCreateTimeStatus" resultType="com.mmtax.business.dto.IncomeWithdrawDTO">
        select
        1 as type,
        actual_amount as incomeAmount,
        create_time as incomeWithdrawTime,
        merchant_name as merchantname,
        order_status as status
        from tbl_trx_order
        where customer_id = #{customerId}
        <if test="status != null">
            and order_status = #{status}
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
        order by create_time desc
        <if test="index != null">
            limit #{index},#{pageSize}
        </if>
    </select>
    <select id="countByCustomerIdCreateTimeStatus" resultType="integer">
        select
        count(0)
        from tbl_trx_order
        where customer_id = #{customerId}
        and order_status = #{status}
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            and create_time between concat(#{startDate},' 00:00:00') and concat(#{endDate},' 23:59:59')
        </if>
    </select>
    <select id="sumActualAmountByBankIdCusId" resultType="decimal">
        select
        sum(actual_amount)
        from tbl_trx_order
        where order_status = 1
        and customer_id = #{customerId}
        and bank_id = #{bankId}
    </select>

    <select id="getPromotionList" resultType="com.mmtax.business.dto.CustomerPromotionDTO">
        select 	t1.batch_no as batchNo,
                t3.customer_no as customerNo,
                t1.payee_name as payeeName,
                t1.merchant_name as merchantName,
                t1.payee_id_card_no as payeeIdCardNo,
                t1.payee_bank_card as payeeBankCard,
                t1.payee_mobile as payeeMobile,
                t1.amount as amount,
                t2.unit_price as unitPrice,
                t2.quantity as quantity,
                t2.province as province,
                t2.city as city,
                t2.area as area,
                t2.street as street,
                t2.community as community,
                t2.promotion_start_time as promotionStartTime,
                t2.promotion_end_time as promotionEndTime,
                t2.create_time as createTime
        from   tbl_customer_promotion t2
        left join tbl_trx_order t1
        on t1.id = t2.trx_order_id
        left join tbl_customer_info t3
        on t3.id = t2.customer_id
        <where>
            <if test="batchNo != null and batchNo != ''">
                and t1.batch_no like concat('%',#{batchNo},'%')
            </if>
            <if test="payeeName != null and payeeName != ''">
                and t1.payee_name like concat('%',#{payeeName},'%')
            </if>
            <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
                and t1.payee_id_card_no like concat('%',#{payeeIdCardNo},'%')
            </if>
            <if test="payeeMobile != null and payeeMobile != ''">
                and t1.payee_mobile like concat('%',#{payeeMobile},'%')
            </if>
            <if test="merchantName != null and merchantName != ''">
                and t1.merchant_name like concat('%',#{merchantName},'%')
            </if>
            <if test="promotionStartTime != null and promotionStartTime !='' and promotionEndTime != null and promotionEndTime != ''">
                and t2.promotion_start_time between concat(#{promotionStartTime},' 00:00:00') and concat(#{promotionEndTime},' 23:59:59')
            </if>
            <if test="startTime != null and startTime !='' and endTime != null and endTime != ''">
                and t2.create_time between concat(#{startTime},' 00:00:00') and concat(#{endTime},' 23:59:59')
            </if>
        </where>
        order by t2.create_time desc
    </select>


    <select id="listPromotions" resultType="com.mmtax.business.dto.CustomerPromotionDTO">
        select 	t1.batch_no as batchNo,
        t3.customer_no as customerNo,
        t1.payee_name as payeeName,
        t1.merchant_name as merchantName,
        t1.payee_id_card_no as payeeIdCardNo,
        t1.payee_bank_card as payeeBankCard,
        t1.payee_mobile as payeeMobile,
        t1.amount as amount,
        t1.charge as charge,
        t2.unit_price as unitPrice,
        t2.quantity as quantity,
        t2.province as province,
        t2.city as city,
        t2.area as area,
        t2.street as street,
        t2.community as community,
        t2.promotion_start_time as promotionStartTime,
        t2.promotion_end_time as promotionEndTime,
        t2.create_time as createTime
        from   tbl_customer_promotion t2
        left join tbl_trx_order t1
        on t1.id = t2.trx_order_id
        left join tbl_customer_info t3
        on t3.id = t2.customer_id
        where 1=1
            <if test="merchantId != null and merchantId != ''">
                and t1.merchant_id = #{merchantId}
            </if>
            <if test="batchNo != null and batchNo != ''">
                and t1.batch_no = #{batchNo}
            </if>
            <if test="payeeName != null and payeeName != ''">
                and t1.payee_name = #{payeeName}
            </if>
            <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
                and t1.payee_id_card_no = #{payeeIdCardNo}
            </if>
            <if test="payeeMobile != null and payeeMobile != ''">
                and t1.payee_mobile = #{payeeMobile}
            </if>
            <if test="merchantName != null and merchantName != ''">
                and t1.merchant_name = #{merchantName}
            </if>
            <if test="promotionStartTime != null and promotionStartTime !='' and promotionEndTime != null and promotionEndTime != ''">
                and t2.promotion_start_time between concat(#{promotionStartTime},' 00:00:00') and concat(#{promotionEndTime},' 23:59:59')
            </if>
            <if test="startTime != null and startTime !='' and endTime != null and endTime != ''">
                and t2.create_time between concat(#{startTime},' 00:00:00') and concat(#{endTime},' 23:59:59')
            </if>
        order by
        t2.create_time desc
        <if test="pageSize != null">
            limit #{startIndex},#{pageSize}
        </if>

    </select>

    <select id="countPromotion" resultType="java.lang.Integer">
        select 	count(1)
        from   tbl_customer_promotion t2
        left join tbl_trx_order t1
        on t1.id = t2.trx_order_id
        left join tbl_customer_info t3
        on t3.id = t2.customer_id
        <where>
            <if test="batchNo != null and batchNo != ''">
                and t1.batch_no = #{batchNo}
            </if>
            <if test="payeeName != null and payeeName != ''">
                and t1.payee_name = #{payeeName}
            </if>
            <if test="payeeIdCardNo != null and payeeIdCardNo != ''">
                and t1.payee_id_card_no = #{payeeIdCardNo}
            </if>
            <if test="payeeMobile != null and payeeMobile != ''">
                and t1.payee_mobile = #{payeeMobile}
            </if>
            <if test="merchantName != null and merchantName != ''">
                and t1.merchant_name = #{merchantName}
            </if>
            <if test="promotionStartTime != null and promotionStartTime !='' and promotionEndTime != null and promotionEndTime != ''">
                and t2.promotion_start_time between concat(#{promotionStartTime},' 00:00:00') and concat(#{promotionEndTime},' 23:59:59')
            </if>
            <if test="startTime != null and startTime !='' and endTime != null and endTime != ''">
                and t2.create_time between concat(#{startTime},' 00:00:00') and concat(#{endTime},' 23:59:59')
            </if>
        </where>
    </select>

    <select id="getAllamoutByBatchNoAndCertificateNo" resultType="java.math.BigDecimal">
        select IFNULL(SUM(t1.amount),0)
        FROM  tbl_trx_order AS t1
        WHERE 1 = 1 and t1.order_status in (-1,1,0)
        <if test="batchNo != null and batchNo != ''">
            and t1.task_record_batch_no = #{batchNo}
        </if>
        <if test="certificateNo != null and certificateNo != ''">
            and t1.payee_id_card_no = #{certificateNo}
        </if>
    </select>

    <select id="getManagerAgreementInfoDTO" resultType="com.mmtax.business.dto.ManagerAgreementInfoDTO">
        SELECT
        t1.payee_name AS NAME,
        t1.payee_id_card_no AS payeeIdCardNo,
        t1.merchant_name AS merchantName,
        t1.payment_channel as paymentChannel,
        t1.payee_bank_card as accountNo,
        DATE_FORMAT(
        MIN(t1.create_time),
        '%Y年%m月%d日'
        ) AS signTime
        FROM
        tbl_trx_order t1
        WHERE
        t1.payee_id_card_no = #{idNumber}
        AND t1.merchant_id = #{merchantId}
        AND t1.order_status = 1
        GROUP BY
        t1.payee_id_card_no
    </select>
    <select id="countTrxOrderFinish" resultType="java.lang.Integer">
        SELECT count(*)
         from tbl_trx_order t1
         join tbl_batch_payment_record t2 on t1.batch_payment_record_id = t2.id
        where t2.id = #{batchPaymentRecordId}
        and t1.order_status not in (-1,0)

    </select>
</mapper>