<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('商户信息')"/>
    <style>
        .ImgView {
            width: 500px;
            height: 520px;
            position: fixed;
            left: 50%;
            top: 50%;
            margin-top: -250px;
            margin-left: -250px;
            background: #fff;
            z-index: 199;
            display: none;
        }
        .closeImage{
            position: absolute;
            font-size: 36px;
            top:0px;
            right: 18px;
            z-index:1000;
            cursor:pointer
        }
        .bg{
            width:100%;
            height: 100%;
            background:rgba(0,0,0,.5);
            position: absolute;
            top: 0px;
            right: 0px;
            left: 0px;
            display: none;
            z-index: 99;
        }
        .license,.contract,.positive,.reverse{
            background: #fff;
            position: fixed;
            z-index: 1000;
            top:100px;
            left:50%;
            margin-left: -250px;
            display: none;
        }
        #img-change,#positive-change,#reverse-change{
            border: 1px solid #eee;
            position: relative;
            left: 50%;
            margin-left: -150px;
            z-index: 100;
        }
        /*.contract .container{*/
        /*margin: 30px auto 0 auto;*/
        /*position: relative;*/
        /*font-family: 微软雅黑;*/
        /*font-size: 12px;*/
        /*width: 750px;*/
        /*}*/
        .container {
            margin: 30px auto 0 auto;
            position: relative;
            font-family: 微软雅黑;
            font-size: 12px;
            /*width: 750px;*/
            width: 500px;
        }
        form{
            margin-top: 30px;
        }
        div.form-group span:not(.tag){
            font-size: 12px;
            color: red;
            display: inline-block;
            height: 17px;
        }
        span.tag >span.tag-text{
            color:#fff;
        }
        .form-group{
            margin-bottom: 6px;
        }
        .select-time .time-input {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: transparent;
            outline: none;
            height: 30px;
            width: 76%;
            padding-left: 10px;
            font-size: 14px;
        }
        .select-time label{
            margin: 0px 10px;
        }

        #legalPersonIdCardExp +label ,#businessLicenseExp +label{
            display: block;
            width: 20px;
            height: 20px;
            cursor: pointer;
            background: rgba(255, 255, 255, 1);
            border:1px solid #aaa;
        }

        #legalPersonIdCardExp:checked +label::before,#businessLicenseExp:checked +label::before {
            display: block;
            content: "\2714";
            text-align: center;
            font-size: 16px;
            color: #666;
        }
    </style>
</head>
<body class="white-bg">
<div class="form-content">
    <div class="row">
        <h4 class="form-header h4">基本信息：</h4>
        <form class="form-horizontal m" th:object="${merchantInfo}" id="form-user-add">

            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>登录名称：</label>
                <div class="col-sm-5">
                    <input name="loginName" autocomplete="off" th:value="*{email}" id="contactsEamil" placeholder="请输入邮箱" class="form-control email" type="text" >
                    <!--<span class="contactsEamil"></span>-->
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>商户编码：</label>
                <div class="col-sm-5">
                    <input type="text" name="merchantCode" th:value="*{merchantCode}" class="form-control" placeholder="请输入文本" readonly>
                </div>
            </div>
<!--            <div class="col-sm-6">-->
                <div class="form-group">
                    <label class="col-sm-3 control-label">归属销售：</label>
                    <div class="col-sm-5">
                        <div class="input-group" style="width: 100%">
                            <select id="belongSalers" name="belongSaler" class="form-control m-b" th:with="type=${@dict.getType('Its_sales')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}" th:selected="*{belongSaler} == ${dict.dictValue}"></option>
                            </select>
                        </div>
                        <!--<input name="belongSaler" autocomplete="off" placeholder="请输入归属商户" class="form-control" type="text">-->
                    </div>
                </div>
<!--            </div>-->
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>企业名称：</label>
                <div class="col-sm-5">
                    <input type="text" name="companyName" th:value="*{companyName}" class="form-control" placeholder="请输入文本" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>商户名称：</label>
                <div class="col-sm-5">
                    <input type="text" name="merchantName" th:value="*{merchantName}" class="form-control" placeholder="请输入文本" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>法人手机号：</label>
                <div class="col-sm-5">
                    <input name="legalPersonMobile" th:value="*{legalPersonMobile}" autocomplete="off" placeholder="请输入法人手机号" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>法人身份证正面照：</label>
                <div class="col-sm-5">
                    <div class="text-center">
                        <a href="javascript:onBanner(2)" style="display: block;width: 120px;height: 120px;border: 1px solid #eee;">
                            <i class="fa fa fa-plus positive_i" style="font-size: 32px; color: #e5e6e7;line-height: 120px;display: none"></i>
                            <img class="img-lg" id="positive" th:src="*{contactsIdCardFront}"/>
                        </a>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>法人身份证反面照：</label>
                <div class="col-sm-5">
                    <div class="text-center">
                        <a href="javascript:onBanner(3)" style="display: block;width: 120px;height: 120px;border: 1px solid #eee;">
                            <i class="fa fa fa-plus reverse_i" style="font-size: 32px; color: #e5e6e7;line-height: 120px;display: none"></i>
                            <img class="img-lg" id="reverse" th:src="*{contactsIdCardBack}"/>
                        </a>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>法人身份证号：</label>
                <div class="col-sm-5">
                    <input name="legalPersonIdCardNo" th:value="*{legalPersonIdCardNo}" autocomplete="off" placeholder="请输入法人身份证号" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label check-box"><span style="color: red; ">*</span>法人身份证有效期：</label>
                <div class="col-sm-5 select-time ">
                    <input type="date" name="legalPersonIdCardExp" th:value="*{legalPersonIdCardExp}" class="form-control time-input" placeholder="请输入文本" required>
                    <input name="role" style="display: none" type="checkbox" th:value="1" th:text="永久有效" id="legalPersonIdCardExp" onclick="checkCardExp(this)">
                    <label for="legalPersonIdCardExp"></label>
                    <!--</label>-->
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-3 control-label">所属行业：</label>
                <div class="col-xs-5">
                    <select class="form-control select2-multiple" id="industrys" name="industry" th:with="type=${@dict.getType('industry_code')}">
                        <option>请选择</option>
                        <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}" th:field="*{industry}"></option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>营业执照注册号：</label>
                <div class="col-sm-5">
                    <input type="text" name="businessLicenseCode" th:value="*{businessLicenseCode}" class="form-control" placeholder="请输入文本" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>营业执照影印件：</label>
                <div class="col-sm-5">
                    <div class="text-center">
                        <a href="javascript:onBanner(0)" style="display: block;width: 120px;height: 120px;border: 1px solid #eee;">
                            <i class="fa fa fa-plus product" style="font-size: 32px; color: #e5e6e7;line-height: 120px;display: none"></i>
                            <img class="img-lg" id="businessLicenseImg" th:src="*{businessLicenseImg}"/></a>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label check-box"><span style="color: red; ">*</span>营业执照有效期：</label>
                <div class="col-sm-5 select-time">
                    <input type="date" class="form-control time-input" name="businessLicenseExp" th:value="*{businessLicenseExp}" placeholder="请输入文本" required>
                    <input name="role" type="checkbox" th:value="1" style="display: none;" th:text="永久有效" id="businessLicenseExp" onclick="checkLicenseExp(this)">
                    <label for="businessLicenseExp"></label>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>商户经营地址：</label>
                <div class="col-sm-5">
                    <input name="merchantAddress" autocomplete="off" th:value="*{merchantAddress}" placeholder="请输入商户经营地址" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>纳税人类型：</label>
                <div class="col-sm-5">
                    <label class="radio-box"> <input type="radio" th:field="*{taxpayerType}" name="taxpayerType" value="0" /> 一般纳税人 </label>
                    <label class="radio-box"> <input type="radio" th:field="*{taxpayerType}" name="taxpayerType" value="1" /> 小规模纳税人 </label>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>合同展示：</label>
                <div class="col-sm-9">
                    <div class="" id="ImgurlBox">
                        <a href="javascript:onBanner(1)" class="AddImg" style="display: inline-block;width: 120px;height: 120px;border: 1px solid #eee;vertical-align: middle;text-align: center;">
                            <i class="fa fa fa-plus contractNo" style="font-size: 32px; color: #e5e6e7;line-height: 120px;"></i>
                        </a>
                        <span th:text="*{contractImgUrl}" style="display: none" id="contractImgUrl"></span>
                    </div>
                </div>
            </div>
            <h4 class="form-header h4">联系信息：</h4>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>联系人邮箱：</label>
                <div class="col-sm-5">
                    <input name="email" autocomplete="off" th:value="*{email}" id="contactsEamil" placeholder="请输入联系人邮箱" class="form-control email" type="text" required readonly>
                    <!--<span class="contactsEamil"></span>-->
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>联系人姓名：</label>
                <div class="col-sm-5">
                    <input name="contacts" th:value="*{contacts}" autocomplete="off" placeholder="请输入联系人姓名" class="form-control" type="text" required>
                    <span class="contacts"></span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>联系人手机号：</label>
                <div class="col-sm-5">
                    <input name="contactsMobile" th:value="*{contactsMobile}" autocomplete="off" id="contactsMobile" placeholder="请输入联系人手机号" class="form-control" type="text" required>
                </div>
            </div>
            <div class="form-group" id="invoiceEmail">
                <label class="col-sm-3 control-label"><span style="color: red;">*</span>接收报税文件邮箱：</label>
                <div class="col-sm-5"  th:each="email : *{emails}">
                    <input type="text" name="invoiceEmail" th:value="${email}" class="form-control" placeholder="请输入接收报税文件邮箱" required style="margin-top: 6px;width: 90%;display: inline-block"><a class="btn btn-success" onclick="addDiv(3)"><i class="fa fa fa-plus"></i></a>
                    <span class="invoiceEmail"></span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"><span style="color: red; ">*</span>联系地址：</label>
                <div class="col-sm-5">
                    <input name="contactsAddress" th:value="*{contactsAddress}" autocomplete="off" placeholder="请输入联系地址" class="form-control" type="text" required>
                    <span class="contactsAddress"></span>
                </div>
            </div>
        </form>
    </div>

    <div class="row" style="margin: 20px auto; height: 90px;line-height: 90px;">
        <div class="col-sm-offset-5 col-sm-3">
            <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭</button>
            <button type="button" class="btn btn-sm btn-success" onclick="submitItem()"><i class="fa fa-check"></i>保 存</button>
        </div>
    </div>
    <div class="license">
        <div class="container" style="text-align: center">
            <input type="file" id="file" style="display: none" onchange="filechange(event)" accept="image/*"/>
            <img width="300px" height="300px" id="licenseImg">
            <i class="fa fa fa-plus banner" style="font-size: 112px; color: #e5e6e7;position: absolute;left:210px;bottom:90px;z-index:-1"></i>
        </div>
        <div class="row" style="margin: 40px auto;">
            <div class="col-sm-offset-4 col-sm-10">
                <button type="button" class="btn btn-sm btn-primary" onclick="submitImg(0)"><i class="fa fa-check"></i>保 存</button>&nbsp;
                <button type="button" class="btn btn-sm btn-danger" onclick="closeImgItem()"><i class="fa fa-reply-all"></i>关 闭 </button>
            </div>
        </div>
    </div>
    <div class="positive">
        <div class="container">
            <input type="file" id="cardFront" style="display: none" onchange="filechange2(event)" accept="image/*"/>
            <img width="300px" height="300px" id="positive-change">
            <i class="fa fa fa-plus banner" style="font-size: 112px; color: #e5e6e7;position: relative;left: 42px;bottom: -24px;"></i>
        </div>
        <div class="row" style="margin: 40px auto;">
            <div class="col-sm-offset-4 col-sm-10">
                <button type="button" class="btn btn-sm btn-primary" onclick="submitImg(2)"><i class="fa fa-check"></i>保 存</button>&nbsp;
                <button type="button" class="btn btn-sm btn-danger" onclick="closeImgItem()"><i class="fa fa-reply-all"></i>关 闭 </button>
            </div>
        </div>
    </div>
    <div class="reverse">
        <div class="container">
            <input type="file" id="cardBack" style="display: none" onchange="filechange3(event)" accept="image/*"/>
            <img width="300px" height="300px" id="reverse-change">
            <i class="fa fa fa-plus banner" style="font-size: 112px; color: #e5e6e7;position: relative;left: 42px;bottom: -24px;"></i>
        </div>
        <div class="row" style="margin: 40px auto;">
            <div class="col-sm-offset-4 col-sm-10">
                <button type="button" class="btn btn-sm btn-primary" onclick="submitImg(3)"><i class="fa fa-check"></i>保 存</button>&nbsp;
                <button type="button" class="btn btn-sm btn-danger" onclick="closeImgItem()"><i class="fa fa-reply-all"></i>关 闭 </button>
            </div>
        </div>
    </div>
    <div class="contract">
        <div class="container" style="text-align: center">
            <input type="file" id="contract" style="display: none" onchange="filechange1(event)" accept="image/*"/>
            <img width="300px" height="300px" id="contractImg">
            <i class="fa fa fa-plus banner" style="font-size: 112px; color: #e5e6e7;position: absolute;left:210px;bottom:90px;z-index:-1"></i>
        </div>
        <div class="row" style="margin: 40px auto;">
            <div class="col-sm-offset-4 col-sm-10">
                <button type="button" class="btn btn-sm btn-primary" onclick="submitImg(1)"><i class="fa fa-check"></i>保 存</button>&nbsp;
                <button type="button" class="btn btn-sm btn-danger" onclick="closeImgItem()"><i class="fa fa-reply-all"></i>关 闭 </button>
            </div>
        </div>
    </div>
    <div class="bg"></div>
    <div class="ImgView">
        <span onclick="closePictures()" class="closeImage">x</span>
        <div style="width: 420px;height: 420px;position: relative;top:40px;left:40px">
            <img class="img-lg" id="viewImgBox" style="width: 100%;height: 100%;text-align: center"/>
        </div>
        <div style="position: relative;bottom: -55px;text-align: center;">
            <button type="button" class="btn btn-sm btn-warning" onclick="deleteImg()"><i class="fa fa-remove"></i>删 除</button>&nbsp;
            <button type="button" class="btn btn-sm btn-danger" onclick="closePictures()"><i class="fa fa-reply-all"></i>关 闭 </button>
        </div>
    </div>
</div>
<div th:include="include::footer"></div>
<script type="text/javascript">
    var prefix = "/manager/merchant"
    $("input[type='text']").attr("onkeyup",'this.value=this.value.replace(/\\s+/g,\'\')');
    $("#form-user-add").validate({
        onkeyup: false,
        rules:{
            companyName:{
                minlength: 2,
                maxlength: 20
            },
            businessLicenseCode:{
                minlength: 5,
                maxlength: 40
            },
            contacts:{
                minlength: 2,
                maxlength: 20
            },
            contactsMobile:{
                isPhone:true
            },
            email:{
                email:true
            },
            invoiceEmail:{
                email:true
            },
            legalPersonMobile: {
                isPhone:true
            },
            legalPersonIdCardNo: {
                isIdentity:true
            }
        },
        messages: {
        },
        focusCleanup: true
    });
    function checkCardExp(checkbox) {
        if ( checkbox.checked == true) {
            $("input[name='legalPersonIdCardExp']").val("9999-12-31")
        }else{
            $("input[name='legalPersonIdCardExp']").val("")
        }
    }
    function checkLicenseExp(checkbox) {
        if ( checkbox.checked == true) {
            $("input[name='businessLicenseExp']").val("9999-12-31")
        }else{
            $("input[name='businessLicenseExp']").val("")
        }
    }
    var imgUrlstr = $("#contractImgUrl").text()
    var imgUrlList = imgUrlstr.split(",")
    var html = ''
    imgUrlList.forEach(function (item) {
        html += '<img class="img-lg" src="'+item+'" style="margin-left: 6px;"/></a>'
    })
    $("#ImgurlBox").prepend(html)
    function submitItem() {
        if ($.validate.form()) {
            var ImgUrlList = $("#ImgurlBox>img")
            var arr = []
            for (var i = 0; i < ImgUrlList.length; i++) {
                arr.push(ImgUrlList[i].src)
            }
            var contractImgUrl = arr.join(",")
            var id = sessionStorage.getItem("id")
            var businessLicenseCode = $("input[name='businessLicenseCode']").val()
            var businessLicenseImg = $("#businessLicenseImg").attr("src")
            var contactsIdCardBack = $("#reverse").attr("src")
            var contactsIdCardFront = $("#positive").attr("src")
            var companyName = $("input[name='companyName']").val()
            var merchantName = $("input[name='merchantName']").val()
            var taxpayerType = $("input[type='radio']:checked").val();
            var industry = $("#industrys option:selected").val();
            if (taxpayerType == undefined||taxpayerType == ''){
                $.modal.msgWarning("请选择纳税人类型")
                return
            }
            var businessLicenseExp = $("input[name='businessLicenseExp']").val()
            var legalPersonIdCardExp = $("input[name='legalPersonIdCardExp']").val()
            var contacts = $("input[name='contacts']").val()
            var contactsAddress = $("input[name='contactsAddress']").val()
            var email = $("input[name='email']").val()
            var legalPersonIdCardNo = $("input[name='legalPersonIdCardNo']").val()
            var legalPersonMobile = $("input[name='legalPersonMobile']").val()
            var merchantAddress = $("input[name='merchantAddress']").val()
            var belongSaler = $("#belongSalers option:selected").val()
            var loginName = $("input[name='loginName']").val()
            var data = {
                id: id,
                businessLicenseCode: businessLicenseCode,
                businessLicenseImg: businessLicenseImg,
                companyName: companyName,
                merchantName: merchantName,
                contacts: contacts,
                contactsAddress: contactsAddress,
                email: email,
                taxpayerType: taxpayerType,
                contractImgUrl: contractImgUrl,
                businessLicenseExp:businessLicenseExp,
                contactsIdCardBack:contactsIdCardBack,
                contactsIdCardFront:contactsIdCardFront,
                industry:industry,
                legalPersonIdCardExp:legalPersonIdCardExp,
                legalPersonIdCardNo:legalPersonIdCardNo,
                legalPersonMobile:legalPersonMobile,
                merchantAddress:merchantAddress,
                belongSaler:belongSaler,
                loginName:loginName
            }
            data = JSON.stringify(data)
            $.ajax({
                url: "/manager/merchant/modifyMerchantInfo",
                data: data,
                type: "post",
                datatype: "json",
                contentType: 'application/json',
                beforeSend: function () {
                    $.modal.loading("正在处理中，请稍后...");
                },
                success: function (result) {
                    if (typeof callback == "function") {
                        callback(result);
                        $.modal.msgSuccess("添加成功");
                    }
                    $.operate.successTabCallback(result);
                }
            })
        }
    }
    function addDiv(){
        var addLength = $("#invoiceEmail div.col-sm-5").length;
        var html = '<div class="col-sm-5 col-sm-offset-3" id="' + addLength + '">' +
            '<input type="text" name="invoiceEmail" class="form-control" placeholder="请输入接收报税文件邮箱" style="margin-top: 6px;width: 90%;display: inline-block"><a class="btn btn-danger" onclick="deleteDiv(' + addLength + ')"><i class="fa fa-remove"></i></a>' +
            '</div>'
        $("#invoiceEmail").append(html)
    }
    function deleteDiv(index){
        var addLength = $("#invoiceEmail div.col-sm-5").length;
        $("#invoiceEmail div.col-sm-5[id='"+index+"']").remove()
    }
    function onBanner(type) {
        if(type == 0) {
            $(".license").css("display","block")
        }else if(type == 1){
            $(".contract").css("display","block")
        }else if(type == 2){
            $(".positive").css("display","block")
        }else{
            $(".reverse").css("display","block")
        }
        $(".bg").css("display","block")
        var height = document.body.scrollHeight
        $(".bg").css("height",height)
    }
    $("#positive-change").click(function () {
        $("#cardFront").click();
    })
    $("#reverse-change").click(function () {
        $("#cardBack").click();
    })
    $("#licenseImg").click(function () {
        $("#file").click();
    })
    $("#contractImg").click(function () {
        $("#contract").click();
    })
    var imgURL;
    var files;
    var options = {
        imgSrc:""
    }
    var filechange=function(event){
        files = event.target.files, file;
        if (files && files.length > 0) {
            file = files[0];
            if(file.size > 1024 * 1024 * 2) {
                alert('图片大小不能超过 2MB!');
                return false;
            }
            var URL = window.URL || window.webkitURL;
            imgURL = URL.createObjectURL(file);
            var reader = new FileReader();
            reader.onload = function(e) {
                imgURL = e.target.result;
                if((imgURL).indexOf("image/")==-1){
                    $.modal.alertWarning("文件格式错误，请上传图片类型,如：JPG，PNG后缀的文件。");
                } else {
                    options.imgSrc = e.target.result
                    if(options.imgSrc.indexOf("data:image/x-icon")!=-1) {
                        options.imgSrc = options.imgSrc.replace("image/x-icon", "image/png")
                    }
                }
            }
            $("#licenseImg").attr("src",imgURL);
            reader.readAsDataURL(file);
        }
    };
    var filechange1=function(event){
        files = event.target.files, file;
        if (files && files.length > 0) {
            file = files[0];
            if(file.size > 1024 * 1024 * 2) {
                alert('图片大小不能超过 2MB!');
                return false;
            }
            var URL = window.URL || window.webkitURL;
            imgURL = URL.createObjectURL(file);
            var reader = new FileReader();
            reader.onload = function(e) {
                imgURL = e.target.result;
                if((imgURL).indexOf("image/")==-1){
                    $.modal.alertWarning("文件格式错误，请上传图片类型,如：JPG，PNG后缀的文件。");
                } else {
                    options.imgSrc = e.target.result
                    if(options.imgSrc.indexOf("data:image/x-icon")!=-1) {
                        options.imgSrc = options.imgSrc.replace("image/x-icon", "image/png")
                    }
                }
            }
            $("#contractImg").attr("src",imgURL);
            reader.readAsDataURL(file);
        }
    };
    var filechange2=function(event){
        files = event.target.files, file;
        if (files && files.length > 0) {
            file = files[0];
            if(file.size > 1024 * 1024 * 2) {
                alert('图片大小不能超过 2MB!');
                return false;
            }
            var URL = window.URL || window.webkitURL;
            imgURL = URL.createObjectURL(file);
            var reader = new FileReader();
            reader.onload = function(e) {
                imgURL = e.target.result;
                if((imgURL).indexOf("image/")==-1){
                    $.modal.alertWarning("文件格式错误，请上传图片类型,如：JPG，PNG后缀的文件。");
                } else {
                    options.imgSrc = e.target.result
                    if(options.imgSrc.indexOf("data:image/x-icon")!=-1) {
                        options.imgSrc = options.imgSrc.replace("image/x-icon", "image/png")
                    }
                }
            }
            $("#positive-change").attr("src",imgURL);
            reader.readAsDataURL(file);
        }
    };
    var filechange3=function(event){
        files = event.target.files, file;
        if (files && files.length > 0) {
            file = files[0];
            if(file.size > 1024 * 1024 * 2) {
                alert('图片大小不能超过 2MB!');
                return false;
            }
            var URL = window.URL || window.webkitURL;
            imgURL = URL.createObjectURL(file);
            var reader = new FileReader();
            reader.onload = function(e) {
                imgURL = e.target.result;
                if((imgURL).indexOf("image/")==-1){
                    $.modal.alertWarning("文件格式错误，请上传图片类型,如：JPG，PNG后缀的文件。");
                } else {
                    options.imgSrc = e.target.result
                    if(options.imgSrc.indexOf("data:image/x-icon")!=-1) {
                        options.imgSrc = options.imgSrc.replace("image/x-icon", "image/png")
                    }
                }
            }
            $("#reverse-change").attr("src",imgURL);
            reader.readAsDataURL(file);
        }
    };
    function getBlob() {
        var imageData = options.imgSrc;
        if(imageData!="") {
            if(imageData.indexOf("data:image/png;base64,")==0) {
                var b64 = imageData.replace('data:image/png;base64,', '');
            }else if(imageData.indexOf("data:image/jpeg;base64,")==0){
                var b64 = imageData.replace('data:image/jpeg;base64,', '');
            }else {
                var b64 = imageData.replace('data:image/jpg;base64,', '');
            }
            var binary = atob(b64);
            var array = [];
            for (var i = 0; i < binary.length; i++) {
                array.push(binary.charCodeAt(i));
            }
            return new Blob([new Uint8Array(array)], {type: 'image/png'});
        }
    }
    function submitImg(type) {
        var img = getBlob()
        if (img == undefined) {
            $.modal.msgWarning("请选择图片")
            return
        }
        var formdata = new FormData();
        formdata.append("file", img);
        $.ajax({
            url: ctx + "common/upload",
            data: formdata,
            type: "post",
            processData: false,
            contentType: false,
            success: function (result) {
                if (type == 0) {
                    $("#businessLicenseImg").attr("src", result.url)
                    $(".license").css("display", "none")
                } else if (type == 1) {
                    var html = '<img class="img-lg" src="'+result.url+'"/></a>'
                    $(".AddImg").before(html);
                    $(".contract").css("display","none")
                } else if (type == 2) {
                    $('#positive').attr('src', result.url);
                    $('#positive').attr('alt', result.fileName);
                    $(".positive").css("display", "none")
                } else {
                    $('#reverse').attr('src', result.url);
                    $('#reverse').attr('alt', result.fileName);
                    $(".reverse").css("display", "none")
                }
                $(".bg").css("display", "none")

            }
        })
    }
    function closeImgItem() {
        $(".bg").css("display","none")
        $(".license").css("display","none")
        $(".contract").css("display","none")
        $(".reverse").css("display", "none")
        $(".positive").css("display", "none")
    }
    $("#ImgurlBox>img").on("click",function () {
        var height = document.body.scrollHeight
        $(".bg").css("display","block")
        $(".ImgView").css("display","block")
        $(".bg").css("height",height)
        $("#viewImgBox").attr("src",$(this)[0].src)
    })
    function closePictures() {
        $(".bg").css("display","none")
        $(".ImgView").css("display","none")
    }
    function deleteImg() {
        var ImgList = $("#ImgurlBox>img")
        var ImgUrl = $("#viewImgBox").attr("src")
        for (var i = 0;i<ImgList.length;i++){
            if(ImgUrl == ImgList[i].src){
                $("#ImgurlBox>img")[i].remove()
                $(".bg").css("display","none")
                $(".ImgView").css("display","none")
            }
        }
    }
</script>
</body>
</html>
